<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">



<mapper namespace="com.itwillbs.mappers.performMapper"> 

   
	<!-- 실적등록에 작업지시 부분 -->
    <resultMap type="map" id="InstrLiMap">
    
	<!--     column= "디비열이름" property="멤버변수이름" -->
    <id column="id" property=""/>
    <result column="instr_id" property="instrId"/>
    <result column="line_cd" property="lineCd"/>
    <result column="line_nm" property="lineName"/>
    <result column="item_num" property="itemNum"/>
    <result column="item_nm" property="itemName"/>
    <result column="work_sts" property="workSts"/>
    <result column="work_dt" property="workDate"/>
    <result column="work_qty" property="workQty"/>
    <result column="ord_num" property="ordNum"/>
    <result column="clnt_nm" property="ClientName"/>
    
    
    </resultMap>
    
    <select id="getInstrLiMap" resultMap="InstrLiMap"> <!-- 처음에 조회되는 작업지시 리스트 -->
    select 
	instr_id, 
	line_cd, 
	line_nm, 
	item_num, 
	item_nm, 
	work_sts, 
	work_dt, 
	work_qty, 
	ord_num,
	clnt_nm
	from prfrm1_view
    </select>
    
    <select id="getSearchInstrLiMap" resultMap="InstrLiMap"> <!--  검색 작업지시 리스트 -->
    select 
	instr_id, 
	line_cd, 
	line_nm, 
	item_num, 
	item_nm, 
	work_sts, 
	work_dt, 
	work_qty, 
	ord_num,
	clnt_nm
	from prfrm1_view
	where line_cd like CONCAT('%', #{line}, '%') 
	<if test="sdate!='' and edate!=''">  <!-- 날짜 둘다 입력한 경우 경우 -->
	and
	work_dt between #{sdate} and #{edate} 	
	</if>
	<if test="sdate=='' and edate==''"> <!-- 날짜 입력하지 않은 경우 -->
	</if>	
	<if test="sdate!=''"> <!-- 시작날짜만 입력한 경우 -->
	and
	work_dt &gt;= #{sdate}
	</if>
	<if test="edate!=''"> <!-- 끝날짜만 입력한 경우 -->
	and
	work_dt &lt;= #{edate}
	</if>
	<choose>
	<when test="(ists1=='' and ists2=='' and ists3=='') or (ists1==null and ists2==null and ists3==null)">
	<!-- 지시상태 선택하지 않은 경우  -->
	</when>
	<otherwise>	<!-- 지시상태 선택한 경우 -->
	and
	(work_sts = #{ists1} or work_sts = #{ists2} or work_sts = #{ists3})
	</otherwise>
	</choose>
	and
	item_num like CONCAT('%', #{pcd}, '%') 
    </select>
    
    
    
   <select id="getInstrMap" resultMap="InstrLiMap"> <!-- 처음에 조회되는 작업지시 리스트 -->
    select 
	instr_id, 
	line_cd, 
	line_nm, 
	item_num, 
	item_nm, 
	work_sts, 
	work_dt, 
	work_qty, 
	ord_num,
	clnt_nm
	from prfrm1_view
	where instr_id = #{instrId}
    </select>
    
  
	
	
	<!-- 실적등록 부분 -->
    <resultMap type="map" id="PfLiMap">
    
	<!--     column= "디비열이름" property="멤버변수이름" -->
	<result column="instr_id" property="instrId"/>
	<result column="prfrm_id" property="performId"/>
    <result column="item_num" property="itemNum"/>
    <result column="item_nm" property="itemName"/>
    <result column="prfrm_dt" property="performDate"/>
    <result column="gb_yn" property="gbYn"/>
    <result column="prfrm_qty" property="performQty"/>
    <result column="db_rsns" property="dbReason"/>

    
    </resultMap>
    
    
    <select id="getPfLiMap" resultMap="PfLiMap">
    select
    p.instr_id,
    p.prfrm_id,
    i.item_num, 
    i.item_nm, 
    p.prfrm_dt, 
    p.gb_yn, 
    p.prfrm_qty, 
    p.db_rsns
    from item i join work_prfrm p
    on i.item_id = p.item_id
    where p.instr_id = #{instrId};
    </select>
	
<!-- 	<select id="getInstr" resultType="com.itwillbs.work.domain.instructDTO"> -->
<!-- 	select -->
<!-- 	instr_id as instrId, -->
<!-- 	line_id as lineId, -->
<!-- 	ord_id as ordId, -->
<!-- 	ord_info_id as ordInfoId, -->
<!-- 	item_id as itemId, -->
<!-- 	work_num as workNum, -->
<!-- 	work_sts as workSts, -->
<!-- 	work_dt as workDate, -->
<!-- 	work_qty as workQty, -->
<!-- 	insert_id as insertId, -->
<!-- 	insert_dt as insertDate -->
<!-- 	from work_instr -->
<!-- 	where instr_id = #{instrId} -->
<!-- 	</select> -->
   
    <insert id="insertPf">
    insert into work_prfrm
    (prfrm_id,
	instr_id,
	line_id,
	item_id, 
	prfrm_dt, 
	input_qty,
	gb_yn,
	prfrm_qty,
	db_rsns,
	note,
	insert_id,  
	insert_dt)
	values
	(performId,
	instrId,
	lineId,
	itemId,
	performDate,
	inputQty,
	gbYn,
	performQty,
	dbReason,
	note,
	insertId,
	insertDate)
    </insert>
   
   
</mapper>
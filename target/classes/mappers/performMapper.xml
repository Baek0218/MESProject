<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">



<mapper namespace="com.itwillbs.mappers.performMapper"> 

   
	<!-- 실적등록에 작업지시 부분 -->
    <resultMap type="map" id="InstrLiMap">
    
	<!--     column= "디비열이름" property="멤버변수이름" -->
    <id column="id" property=""/>
    <result column="instr_id" property="instrId"/>
    <result column="line_cd" property="lineCd"/>
    <result column="line_nm" property="lineName"/>
    <result column="item_num" property="itemNum"/>
    <result column="item_nm" property="itemName"/>
    <result column="work_sts" property="workSts"/>
    <result column="work_dt" property="workDate"/>
    <result column="work_qty" property="workQty"/>
    <result column="ord_num" property="ordNum"/>
    <result column="clnt_nm" property="ClientName"/>
    
    
    </resultMap>
    
    <select id="getInstrLiMap" resultMap="InstrLiMap"> <!-- 처음에 조회되는 작업지시 리스트 -->
    select 
	instr_id, 
	line_cd, 
	line_nm, 
	item_num, 
	item_nm, 
	work_sts, 
	work_dt, 
	work_qty, 
	ord_num,
	clnt_nm
	from prfrm1_view
    </select>
    
    <select id="getSearchInstrLiMap" resultMap="InstrLiMap"> <!--  검색 작업지시 리스트 -->
    select 
	instr_id, 
	line_cd, 
	line_nm, 
	item_num, 
	item_nm, 
	work_sts, 
	work_dt, 
	work_qty, 
	ord_num,
	clnt_nm
	from prfrm1_view
	where line_cd like CONCAT('%', #{line}, '%') 
	<if test="sdate!='' and edate!=''">  <!-- 날짜 둘다 입력한 경우 경우 -->
	and
	work_dt between #{sdate} and #{edate} 	
	</if>
	<if test="sdate=='' and edate==''"> <!-- 날짜 입력하지 않은 경우 -->
	</if>	
	<if test="sdate!=''"> <!-- 시작날짜만 입력한 경우 -->
	and
	work_dt &gt;= #{sdate}
	</if>
	<if test="edate!=''"> <!-- 끝날짜만 입력한 경우 -->
	and
	work_dt &lt;= #{edate}
	</if>
	<choose>
	<when test="(ists1=='' and ists2=='' and ists3=='') or (ists1==null and ists2==null and ists3==null)">
	<!-- 지시상태 선택하지 않은 경우  -->
	</when>
	<otherwise>	<!-- 지시상태 선택한 경우 -->
	and
	(work_sts = #{ists1} or work_sts = #{ists2} or work_sts = #{ists3})
	</otherwise>
	</choose>
	and
	item_num like CONCAT('%', #{pcd}, '%') 
    </select>
  
	
   
   
   
</mapper>
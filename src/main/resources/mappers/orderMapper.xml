<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.itwillbs.mappers.orderMapper">

	<resultMap type="map" id="orderMap">

		<result column="ord_id" property="ordId" />
		<result column="clnt_cd" property="clntCd" />
		<result column="clnt_nm" property="clntNm" />
		<result column="order_dt" property="orderDt" />
		<result column="dlvry_dt" property="dlvryDt" />
		<result column="id" property="id" />
		<result column="name" property="name" />
		<result column="csmtr_ord_num" property="csmtrOrdNum" />

	</resultMap>
	
	<select id="orderMap" resultMap="orderMap">		
		select c.clnt_cd, c.clnt_nm, o.order_dt, o.dlvry_dt, u.id,u.name,o.csmtr_ord_num
		from client c join order_mng o
		on c.clnt_id = o.clnt_id
		join user u
		on o.user_id = u.user_id
		order by c.clnt_id desc
		limit #{startRow}, #{pageSize}
	</select>
	
	<select id="orderSearchMap" resultMap="orderMap">		
		select c.clnt_cd, c.clnt_nm, o.order_dt, o.dlvry_dt, u.id,u.name,o.csmtr_ord_num
		from client c join order_mng o
		on c.clnt_id = o.clnt_id
		join user u
		on o.user_id = u.user_id
<!-- 		where o.ord_id like CONCAT('%', #{clntCd}, '%')  -->
		<if test="orderDt1!='' and orderDt2!=''">  <!-- 날짜 둘다 입력한 경우 경우 -->
		where
		work_dt between #{orderDt1} and #{orderDt2} 	
		</if>
		<if test="orderDt1=='' and orderDt2==''"> <!-- 날짜 입력하지 않은 경우 -->
		</if>	
		<if test="orderDt1!=''"> <!-- 시작날짜만 입력한 경우 -->
		and
		order_dt &gt;= #{orderDt1}
		</if>
		<if test="orderDt2!=''"> <!-- 끝날짜만 입력한 경우 -->
		and
		order_dt &lt;= #{orderDt2}
		</if>
<!-- 		and -->
<!-- 		name like CONCAT('%', #{name}, '%')  -->
<!-- 		order by order_dt desc -->
		limit #{startRow}, #{pageSize}
   	 </select>
   	 
   	<select id="countOrder" resultType="java.lang.Integer"> <!-- 작업지시리스트 개수 -->
    select
    count(*)
    from order_mng
<!-- 	from client c join order_mng o -->
<!-- 		on c.clnt_id = o.clnt_id -->
<!-- 		join user u -->
<!-- 		on o.user_id = u.user_id -->
<!-- 		where o.ord_id like CONCAT('%', #{clntCd}, '%')  -->
<!-- 		<if test="orderDt1!='' and orderDt2!=''">  날짜 둘다 입력한 경우 경우 -->
<!-- 		and -->
<!-- 		work_dt between #{orderDt1} and #{orderDt2} 	 -->
<!-- 		</if> -->
<!-- 		<if test="orderDt1=='' and orderDt2==''"> 날짜 입력하지 않은 경우 -->
<!-- 		</if>	 -->
<!-- 		<if test="orderDt1!=''"> 시작날짜만 입력한 경우 -->
<!-- 		and -->
<!-- 		order_dt &gt;= #{orderDt1} -->
<!-- 		</if> -->
<!-- 		<if test="orderDt2!=''"> 끝날짜만 입력한 경우 -->
<!-- 		and -->
<!-- 		order_dt &lt;= #{orderDt2} -->
<!-- 		</if> -->
<!-- 		and -->
<!-- 		name like CONCAT('%', #{name}, '%')  -->
<!-- 		order by order_dt desc -->
<!-- 		limit #{startRow}, #{pageSize} -->
   	 </select>
 	
	<sql id="List">
		select c.clnt_cd, c.clnt_nm, o.order_dt, o.dlvry_dt, u.id,u.name,o.csmtr_ord_num
		from client c join order_mng o
		on c.clnt_id = o.clnt_id
		join user u
		on o.user_id = u.user_id
	</sql>

</mapper>


<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">



<mapper namespace="com.itwillbs.mappers.performMapper">
  
	<select id="InstruList" resultType="com.itwillbs.work.domain.InstruListDTO">
	select 
	instr_id as instrId, 
	line_cd as lineCd, 
	line_nm as lineName, 
	item_num as itemNum, 
	item_nm as itemName, 
	work_sts as workSts, 
	work_dt as workDate, 
	work_qty as workQty, 
	ord_num as ordNum,
	clnt_nm as ClientName
	from prfrm1_view
	</select> <!-- 끝까지 안쓰면 지울것 -->
   

   
	<!-- 실적등록에 작업지시 부분 -->
    <resultMap type="map" id="InstrLiMap">
    
	<!--     column= "디비열이름" property="멤버변수이름" -->
    <id column="id" property=""/>
    <result column="instr_id" property="instrId"/>
    <result column="line_cd" property="lineCd"/>
    <result column="line_nm" property="lineName"/>
    <result column="item_num" property="itemNum"/>
    <result column="item_nm" property="itemName"/>
    <result column="work_sts" property="workSts"/>
    <result column="work_dt" property="workDate"/>
    <result column="work_qty" property="workQty"/>
    <result column="ord_num" property="ordNum"/>
    <result column="clnt_nm" property="ClientName"/>
    
    
    </resultMap>
    
    <select id="getInstrLiMap" resultMap="InstrLiMap"> <!-- 처음에 조회되는 작업지시 리스트 -->
    select 
	instr_id, 
	line_cd, 
	line_nm, 
	item_num, 
	item_nm, 
	work_sts, 
	work_dt, 
	work_qty, 
	ord_num,
	clnt_nm
	from prfrm1_view
    </select>
    
    <select id="getSearchInstrLiMap" resultMap="InstrLiMap"> <!--  검색 작업지시 리스트 -->
    select 
	instr_id, 
	line_cd, 
	line_nm, 
	item_num, 
	item_nm, 
	work_sts, 
	work_dt, 
	work_qty, 
	ord_num,
	clnt_nm
	from prfrm1_view
	where line_cd like CONCAT('%', #{line}, '%') 
	<if test="sdate!='' and edate!=''">  <!-- 날짜 둘다 입력한 경우 경우 -->
	and
	work_dt between #{sdate} and #{edate} 	
	</if>
	<if test="sdate=='' and edate==''"> <!-- 날짜 입력하지 않은 경우 -->
	</if>	
	<if test="sdate!=''"> <!-- 시작날짜만 입력한 경우 -->
	and
	work_dt &gt;= #{sdate}
	</if>
	<if test="edate!=''"> <!-- 끝날짜만 입력한 경우 -->
	and
	work_dt &lt;= #{edate}
	</if>
	<choose>
	<when test="(ists1=='' and ists2=='' and ists3=='') or (ists1==null and ists2==null and ists3==null)">
	<!-- 지시상태 선택하지 않은 경우  -->
	</when>
	<otherwise>	<!-- 지시상태 선택한 경우 -->
	and
	(work_sts = #{ists1} or work_sts = #{ists2} or work_sts = #{ists3})
	</otherwise>
	</choose>
	and
	item_num like CONCAT('%', #{pcd}, '%') 
    </select>
  
    
   
  
   
   
   <!--  안쓰면 지울 것 -->
   <select id="PerformRgList" resultType="com.itwillbs.work.domain.PerformRgDTO">
   select 
   i.item_num as itemNum, 
   i.item_nm as itemName, 
   p.prfrm_dt as performDate, 
   p.gb_yn as gbYn, 
   p.prfrm_qty as performQty, 
   p.db_rsns as dbReason
   from item i join work_prfrm p
   on i.item_id = p.item_id
   where p.instr_id = #{instrId}
   
   </select>
   
   <insert id="insertPerform">
   insert into work_prfrm
   (`prfrm_id`, `instr_id`, `line_id`, `item_id`, `prfrm_dt`, `input_qty`, `gb_yn`, `prfrm_qty`, `db_rsns`, 
   `note`, `insert_id`, `insert_dt`) VALUES
   (#{prfrm_id}, 1,1,1, #{prfrm_dt}, 1, #{gb_yn}, #{prfrm_qty}, #{db_rsns}, 
   1,1, #{insert_dt})
   
   </insert>

<!--  #{instr_id}, #{line_id}, #{item_id},   #{input_qty},  #{note}, #{insert_id} -->
   	<select id="getMaxNumP" resultType="java.lang.Integer">
		select max(prfrm_id) from work_prfrm
	</select>
	
	
   
   
   
</mapper>